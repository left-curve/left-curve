set positional-arguments

# List available recipes
default:
  @just --list

edit-secrets:
  ansible-vault edit group_vars/all/vault.yml

cold-provision:
  ansible-playbook playbook.yml

provision:
  ansible-playbook playbook.yml --skip-tags setup

# Set up Python environment and install Ansible + role
setup:
  python3 -m venv .venv
  source .venv/bin/activate && pip install --upgrade pip
  source .venv/bin/activate && pip install ansible
  source .venv/bin/activate && ansible-galaxy collection install -r requirements.yml

deploy-github-runners:
  ansible-playbook setup-github-runner-hosts.yml
  ansible-playbook install-github-runner-hosts.yml

reset-and-deploy-testnet:
  ansible-playbook full-app.yml -e '{"traefik_enabled": true, "cometbft_generate_keys": true, "dex_bot_enabled": true, "github_deployments_enabled": false, "expose_ports": false, "delete_postgres_database_at_merge": false, "delete_clickhouse_database_at_merge": false, "deploy_includes_postgres": false, "deploy_includes_clickhouse": false, "chain_id": "dev-6", "dango_network": "testnet", "system_wide_directories": true, "deploy_env": "production", "keep_databases": true, "dango_image_tag": "latest", "frontend_image_tag": "latest", "reset_data": true}'

deploy-testnet:
  ansible-playbook full-app.yml -e '{"traefik_enabled": true, "cometbft_generate_keys": true, "dex_bot_enabled": true, "github_deployments_enabled": false, "expose_ports": false, "delete_postgres_database_at_merge": false, "delete_clickhouse_database_at_merge": false, "deploy_includes_postgres": false, "deploy_includes_clickhouse": false, "chain_id": "dev-6", "dango_network": "testnet", "system_wide_directories": true, "deploy_env": "production", "keep_databases": true, "dango_image_tag": "latest", "frontend_image_tag": "latest"}'

deploy-devnet:
  ansible-playbook full-app.yml -e '{"traefik_enabled": true, "cometbft_generate_keys": true, "dex_bot_enabled": true, "github_deployments_enabled": false, "expose_ports": false, "delete_postgres_database_at_merge": true, "delete_clickhouse_database_at_merge": true, "deploy_includes_postgres": false, "deploy_includes_clickhouse": false, "dango_network": "devnet", "deploy_env": "production", "chain_id": "dev-9", "dango_image_tag": "latest", "frontend_image_tag": "latest", "frontend_banner": "You are using devnet"}'

deploy-preview-latest:
  ansible-playbook full-app.yml -e '{"expose_ports": true, "dex_bot_enabled":true, "cometbft_generate_keys":true}' -e deploy_env=preview -e dango_image_tag=latest -e dango_network=previewnet -e frontend_image_tag=latest -e chain_id=preview

deploy-dozzle:
  ansible-playbook dozzle.yml

deploy-monitoring:
  ansible-playbook monitoring.yml

deploy-tailscale:
  ansible-playbook tailscale.yml

deploy-db:
  ansible-playbook db.yml

deploy-clickhouse:
  ansible-playbook clickhouse.yml
